table_name: financial_summary_by_student
version: "2.0"
record_count: 10000

metadata:
  purpose: "Financial summary including tuition, payments, scholarships, and balances per student"
  updated_at: "2026-01-23"
  note: "One record per student with all financial aggregations pre-calculated"

columns:
  # Student Context (Denormalized)
  - name: student_id
    type: INTEGER
    description: "Unique identifier for each student"
    nullable: false
    primary_key: true
    statistics:
      min: 1
      max: 10000
      distinct_count: 10000

  - name: student_first_name
    type: VARCHAR(100)
    description: "Student's first name"
    nullable: false

  - name: student_last_name
    type: VARCHAR(100)
    description: "Student's last name"
    nullable: false

  - name: student_email
    type: VARCHAR(200)
    description: "Student's email address"
    nullable: false

  - name: student_major
    type: VARCHAR(100)
    description: "Student's declared major"
    nullable: false
    value_type: categorical
    possible_values:
      - "Computer Science"
      - "Business"
      - "Engineering"
      - "Biology"
      - "Psychology"
      - "Economics"
      - "Mathematics"
      - "English"
      - "History"
      - "Physics"

  - name: student_status
    type: VARCHAR(50)
    description: "Current enrollment status"
    nullable: false
    value_type: categorical
    possible_values:
      - "Active"
      - "Graduated"
      - "On Leave"
    query_notes: "Most students (80%) are Active, rest are Graduated or On Leave"

  - name: student_gpa
    type: DECIMAL(3,2)
    description: "Student's current GPA"
    nullable: false
    value_type: continuous
    statistics:
      min: 2.00
      max: 4.00

  - name: student_enrollment_date
    type: DATE
    description: "Date when student first enrolled"
    nullable: false
    statistics:
      range: "Last 4 years from data generation date"

  # Department Context
  - name: student_department_name
    type: VARCHAR(100)
    description: "Department name matching student's major"
    nullable: false
    value_type: categorical

  - name: student_department_id
    type: INTEGER
    description: "Department ID"
    nullable: false
    statistics:
      min: 1
      max: 20

  # Tuition and Payment Aggregations (Pre-calculated)
  - name: total_tuition_due
    type: DECIMAL(10,2)
    description: "Total tuition amount due for the student"
    nullable: false
    value_type: continuous
    statistics:
      min: 5000.00
      max: 65000.00
    query_notes: "Calculated as total_tuition_paid + outstanding_balance"

  - name: total_tuition_paid
    type: DECIMAL(10,2)
    description: "Total amount of tuition paid by student"
    nullable: false
    value_type: continuous
    statistics:
      min: 5000.00
      max: 60000.00
    query_notes: "Sum of all completed payments"

  - name: outstanding_balance
    type: DECIMAL(10,2)
    description: "Remaining unpaid tuition balance"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
      max: 5000.00
    query_notes: "Most students have some outstanding balance. Filter by has_outstanding_balance flag for non-zero balances"

  - name: last_payment_date
    type: DATE
    description: "Date of most recent payment"
    nullable: false
    value_type: continuous
    statistics:
      range: "Last 1 year from data generation date"

  - name: last_payment_amount
    type: DECIMAL(10,2)
    description: "Amount of most recent payment"
    nullable: false
    value_type: continuous
    statistics:
      min: 1000.00
      max: 10000.00

  - name: last_payment_method
    type: VARCHAR(50)
    description: "Payment method used for most recent payment"
    nullable: false
    value_type: categorical
    possible_values:
      - value: "Credit Card"
        frequency: 0.25
      - value: "Bank Transfer"
        frequency: 0.25
      - value: "Check"
        frequency: 0.25
      - value: "Financial Aid"
        frequency: 0.25
    query_notes: "Evenly distributed across payment methods"

  # Scholarship Aggregations (Pre-calculated)
  - name: total_scholarships_received
    type: DECIMAL(10,2)
    description: "Total scholarship amount received by student"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
      max: 25000.00
    query_notes: "Sum of all scholarship types. Can be 0 for students without scholarships"

  - name: scholarship_count
    type: INTEGER
    description: "Number of scholarships awarded to student"
    nullable: false
    value_type: continuous
    statistics:
      min: 0
      max: 3
    query_notes: "0 if no scholarships, otherwise 0-3 scholarships per student"

  - name: merit_scholarships_total
    type: DECIMAL(10,2)
    description: "Total amount from merit-based scholarships"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
    query_notes: "Typically 40-70% of total scholarships when applicable"

  - name: need_based_scholarships_total
    type: DECIMAL(10,2)
    description: "Total amount from need-based scholarships"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
    query_notes: "Typically 20-50% of total scholarships when applicable"

  - name: athletic_scholarships_total
    type: DECIMAL(10,2)
    description: "Total amount from athletic scholarships"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
    query_notes: "Typically 0-30% of total scholarships when applicable"

  - name: departmental_scholarships_total
    type: DECIMAL(10,2)
    description: "Total amount from departmental scholarships"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
    query_notes: "Typically 10-30% of total scholarships when applicable"

  # Financial Metrics (Pre-calculated)
  - name: net_tuition_after_scholarships
    type: DECIMAL(10,2)
    description: "Net tuition cost after scholarship deductions"
    nullable: false
    value_type: continuous
    query_notes: "Calculated as total_tuition_paid - total_scholarships_received. Can be negative if scholarships exceed payments"

  - name: scholarship_coverage_rate_pct
    type: DECIMAL(5,2)
    description: "Percentage of tuition covered by scholarships"
    nullable: false
    value_type: continuous
    statistics:
      min: 0.00
      max: 300.00
    query_notes: |
      Calculated as (total_scholarships_received / (total_tuition_paid + 0.01)) * 100
      Can exceed 100% if scholarships are greater than tuition paid
      >= 75% indicates most tuition covered
      50-74% indicates significant coverage
      < 50% indicates lower coverage

  # Flags
  - name: has_outstanding_balance
    type: BOOLEAN
    description: "True if student has unpaid tuition balance"
    nullable: false
    value_type: boolean
    query_notes: "Useful for identifying students with payment issues. Most students have some outstanding balance"

  - name: is_scholarship_recipient
    type: BOOLEAN
    description: "True if student has received any scholarships"
    nullable: false
    value_type: boolean
    query_notes: "Check total_scholarships_received > 0 or scholarship_count > 0"

# Relationships
relationships:
  - target_table: "student_enrollment_analytics"
    join_keys:
      - student_id
    relationship_type: "one-to-one"
    description: "One financial summary per student"

  - target_table: "student_academic_performance"
    join_keys:
      - student_id
    relationship_type: "one-to-many"
    description: "Academic performance data for each student"

  - target_table: "scholarship_recipient_analysis"
    join_keys:
      - student_id
    relationship_type: "one-to-many"
    description: "Detailed scholarship records for each student"

# Indexes
indexes:
  - columns: [student_id]
    type: "primary_key"
  - columns: [has_outstanding_balance]
    type: "index"
    usage: "Frequently used to identify students with payment issues"
  - columns: [is_scholarship_recipient]
    type: "index"
    usage: "Frequently used for scholarship-related queries"
  - columns: [scholarship_coverage_rate_pct]
    type: "index"
    usage: "Common for analyzing scholarship effectiveness"
